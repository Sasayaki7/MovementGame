<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Movement Game</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="{{url_for('static', filename='css/opencv_game.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='css/header-format.css')}}">

</head>
<body onload="onBodyLoad()">
    <div huemin={{user.current_settings.huemin}} huemax={{user.current_settings.huemax}} satmin={{user.current_settings.satmin}} 
        satmax = {{user.current_settings.satmax}} valmin = {{user.current_settings.valmin}} valmax = {{user.current_settings.valmax}} id="calibration-data" style="display: none;">
    </div>
    <div class="header">
    <a href='/logout' class='btn btn-danger'>Logout</a>
    </div>
    <canvas id="camera" width="320" height="240" class='no-show'></canvas>
    <img id='image' src="../static/images/neon-lights-stage.jpg" style="display: none;">
    <canvas id="background" width="640" height="480" style="display: none;"></canvas>
    <audio controls id="music" style="display: none;">
        <source src="{{url_for('static', filename='audio/')}}" type="audio/mpeg">
    </audio>
    <form id='submission-form'></form>

    <video id="videoInput" width="640" height = "480" style="display: none;"></video>        
    <div class="inputoutput">
        <div class="overlay">
            <div class="left-menu">
                <button onclick="play()">Play</button>
                <a href="/calibration">Calibrate</a>
                <button onclick="showleaderboard()">Leaderboard</button>
                <button onclick="exit()">Exit</button>
            </div>
            <div class="songinfo no-show">
                <p>Total songs: <span id='total-songs'>{{songs|length}}</span></p>
                <div class="songselector">
                    <button class="song-pick-button" onclick="prevSong();">Prev: </button>  
                    <div class="song-picker-center">
                        <p>Song: <span id='song-name'></span></p>
                        <p>Best score: <span id='song-score'></span></p>
                    </div>
                    <button class="song-pick-button" onclick="nextSong();">Next: </button> 
                </div>
                <button class="selector selector-button" onclick="selectSong()">Select</button>
            </div>
            <div class="score-output no-show">
                <p>Your Score:</p>
                <div class="banner">
                    <p id='final-score-display'>1500</p>
                </div>
                <button onclick="hideOutput(); showleaderboard();" class="selector-button">See Leaderboard</button>
            </div>
            <button class="start-button no-show" onclick="onStartVisual(); onStart();">Start</button>
            <div class="leaderboard-display no-show">
                <div class="leaderboard-header">
                    <button class="song-pick-button leaderboard-song-select" onclick="prevSongLDB();"> &lt; </button>  
                    <div class="song-picker-center leaderboard-song-display">
                        <p id='song-name-leaderboard'></p>
                    </div>
                    <button class="song-pick-button leaderboard-song-select" onclick="nextSongLDB();"> &gt; </button>  
                </div>
                <p id="your-best-score-label">Your Best Score: <span id='your-high-score'>0</span></p>
                <table class='leaderboard'>
                    <thead>
                        <tr>
                            <th>Ranking:</th>
                            <th>Score:</th>
                            <th>Username:</th>
                            <th>Date:</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard-body">
                        
                    </tbody>
                </table>
            </div>
            <button id="backButton" class="bbtn no-show" onclick="backButton()">← Back</button>
            <button id="returnButton" class="bbtn no-show" onclick="returnToSelector()">← Back</button>

        </div>
        <canvas id="canvasOutput" >
            
        </canvas>
    </div>
    <p>Score: <span id='score-display'>0</span></p>
    





    <form method="POST" id='fileform'>
        <input type="hidden" name="filename" value="\\opm-op-seq.json">
    </form>


    <button class='btn btn-primary' onclick="toggle()">Toggle camera</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script src="{{url_for('static', filename='js/webcam_detection.js')}}"></script>
    <script src="{{url_for('static', filename='js/movement_game_visual.js')}}"></script>
    <script src="{{url_for('static', filename='js/leaderboard-handler.js')}}"></script>
    <script async src="{{url_for('static', filename='js/opencv.js')}}" onload="onOpenCvReady();" type="text/javascript"></script>
</body>
</html>